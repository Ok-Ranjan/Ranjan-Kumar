{% extends 'base.html' %}
{% load static %}
{% block title %}Home - My Portfolio{% endblock %}

{% block content %}
<!-- Hero Section -->
<section id="home" class="hero">
    <div class="hero-content">
        <h1 class="typewriter-text"></h1>
        <p>Aspiring Software Engineer | Web Developer | Cybersecurity Enthusiast</p>
        <a href="#about" class="btn">Explore More</a>
    </div>
</section>

<!-- About Section -->
<section id="about" class="about">
    <h2>About Me</h2>
    <div class="about-container">
        <img src="{% static 'images/ranjan_pic.jpg' %}" alt="Profile" class="profile-pic">
        <div class="about-text">
            <p>I am a B.Tech CSE student passionate about coding, web development, and cybersecurity. 
               My goal is to become a professional software engineer and ethical hacker. 
               I love building projects and learning new technologies.</p>
            <canvas id="skillsChart" width="400" height="300"></canvas>
        </div>
    </div>
</section>

<!-- Projects Section -->
<section id="projects" class="projects">
    <h2>My Projects</h2>
    <div class="projects-container">
        {% for project in projects %}
        <div class="project-card">
            {% if project.preview_image %}
                <img src="{{ project.preview_image.url }}" alt="{{ project.title }}">
            {% endif %}
            {% if project.preview_video %}
                <video controls>
                    <source src="{{ project.preview_video.url }}" type="video/mp4">
                </video>
            {% endif %}
            <h3>{{ project.title }}</h3>
            <p>{{ project.description }}</p>
            <div class="project-links">
                {% if project.github_link %}
                    <a href="{{ project.github_link }}" target="_blank">GitHub</a>
                {% endif %}
                {% if project.demo_link %}
                    <a href="{{ project.demo_link }}" target="_blank">Live Demo</a>
                {% endif %}
            </div>
        </div>
        {% empty %}
        <p>No projects added yet.</p>
        {% endfor %}
    </div>
</section>

<!-- Achievements Section -->
<section id="achievements" class="achievements">
    <h2>Achievements & Certificates</h2>
    <div class="carousel">
        <div class="carousel-track">
            {% for achievement in achievements %}
            <div class="carousel-item">
                <img src="{{ achievement.certificate_image.url }}" alt="{{ achievement.title }}">
                <h3>{{ achievement.title }}</h3>
                {% if achievement.description %}
                    <p>{{ achievement.description }}</p>
                {% endif %}
                {% if achievement.date_awarded %}
                    <small>{{ achievement.date_awarded }}</small>
                {% endif %}
            </div>
            {% empty %}
            <p>No achievements added yet.</p>
            {% endfor %}
        </div>
    </div>
</section>

<!-- CounterSection -->
 

<!-- Resume Section -->
<section id="resume" class="resume">
    <h2>My Resume</h2>
    {% if resume %}
        <iframe 
            src="https://docs.google.com/gview?url={{ resume_url }}&embedded=true" 
            style="width:100%; height:500px;" 
            frameborder="0">
        </iframe>
        <br>
        <a href="{{ resume.pdf_file.url }}" download class="btn">Download Resume</a>
    {% else %}
        <p>Resume will be uploaded soon.</p>
    {% endif %}
</section>

<!-- Github Section -->
{% if github_data %}
<section id="github" class="github">
    <h2>GitHub Stats</h2>
    <div class="github-container">
        
        <!-- Profile Card -->
        <div class="github-card">
            <img src="{{ github_data.avatar }}" alt="GitHub Avatar" class="github-avatar">
            <h3>{{ github_data.name }}</h3>
            <p>@{{ github_data.username }}</p>
            <p class="bio">{{ github_data.bio }}</p>
            <a href="{{ github_data.profile_url }}" target="_blank" class="btn">View Profile</a>
        </div>

        <!-- Stats Card -->
        <!-- <div class="github-card">
            <h3>Statistics</h3>
            <p>üì¶ Public Repos: {{ github_data.public_repos }}</p>
            <p>‚≠ê Stars: {{ github_data.stars }}</p>
            <p>üë• Followers: {{ github_data.followers }}</p>
        </div> -->

        <!-- Languages Card -->
        <div class="github-card">
            <h3>Most Used Languages</h3>
            <canvas id="languageChart" width="300" height="300"></canvas>
        </div>

        <!-- GitHub Readme Stats Card -->
        <!-- <div class="github-card">
            <h3>Overall GitHub Stats</h3>
            <img src="https://github-readme-stats.vercel.app/api?username=Ok-Ranjan&show_icons=true&theme=dark&hide_border=true" 
                alt="GitHub Stats" class="github-stats-img">
        </div> -->


        <!-- Contribution Graph & Streak -->
        <!-- <div class="github-extra">
            <h3>Contribution Activity</h3>
            <img src="https://ghchart.rshah.org/Ok-Ranjan" alt="GitHub Contributions" class="github-chart">

            <h3>Current Streak</h3>
            <img src="https://github-readme-streak-stats.herokuapp.com?user=Ok-Ranjan&theme=dark&hide_border=true" alt="GitHub Streak Stats" class="github-chart">
        </div> -->


    </div>
</section>
{% endif %}




<!-- Contact Section -->
<section id="contact" class="contact">
    <h2>Contact Me</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
            {{ form.name.label_tag }} {{ form.name }}
        </div>
        <div class="form-group">
            {{ form.email.label_tag }} {{ form.email }}
        </div>
        <div class="form-group">
            {{ form.message.label_tag }} {{ form.message }}
        </div>
        <div class="form-group">
            {{ form.file.label_tag }} {{ form.file }}
        </div>
        <button type="submit">Send Message</button>
    </form>
</section>


{% endblock %}

{% block extra_scripts %}
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/scrollreveal"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
{% if github_data %}
    const langLabels = {{ lang_labels|safe }};
    const langValues = {{ lang_values|safe }};
    const ctxLang = document.getElementById('languageChart').getContext('2d');

    new Chart(ctxLang, {
        type: 'pie',
        data: {
            labels: langLabels,
            datasets: [{
                data: langValues,
                backgroundColor: [
                    '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'
                ]
            }]
        }
    });
{% endif %}
// ScrollReveal animations (replay each time)
ScrollReveal().reveal('.hero-content', { reset: true, delay: 200, origin: 'top', distance: '50px', duration: 1000 });
ScrollReveal().reveal('.about-container', { reset: true, delay: 200, origin: 'bottom', distance: '50px', duration: 1000 });

// Typewriter animation (replay on re-entry)
function startTypewriter() {
    const typewriterElement = document.querySelector('.typewriter-text');
    const text = "Hi, I'm Ranjan Kumar";
    let index = 0;
    typewriterElement.textContent = ""; // clear text before typing again
    function typeWriter() {
        if (index < text.length) {
            typewriterElement.textContent += text.charAt(index);
            index++;
            setTimeout(typeWriter, 100);
        }
    }
    typeWriter();
}

// Radar chart animation (replay on re-entry)
let chartInstance = null;

function drawChart() {
    const ctx = document.getElementById('skillsChart').getContext('2d');

    if (chartInstance) {
        chartInstance.destroy();
    }

    // Django template variables for skills
    const skillLabels = JSON.parse('{{ skill_labels| safe }}');
    const skillValues = JSON.parse('{{ skill_values| safe }}');

    chartInstance = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: skillLabels,
            datasets: [{
                label: 'Skill Level',
                data: skillValues,
                fill: true,
                backgroundColor: 'rgba(0, 123, 255, 0.2)',
                borderColor: 'rgb(0, 123, 255)',
                pointBackgroundColor: 'rgb(0, 123, 255)'
            }]
        },
        options: {
            animation: {
                duration: 2000,
                easing: 'easeOutBounce'
            },
            scales: {
                r: {
                    suggestedMin: 0,
                    suggestedMax: 100
                }
            }
        }
    });
}



// Intersection Observers that reset each time
const heroObserver = new IntersectionObserver((entries) => {
    if (entries[0].isIntersecting) {
        startTypewriter();
    }
}, { threshold: 0.5 });

const aboutObserver = new IntersectionObserver((entries) => {
    if (entries[0].isIntersecting) {
        drawChart();
    }
}, { threshold: 0.5 });

heroObserver.observe(document.querySelector('.hero'));
aboutObserver.observe(document.querySelector('#about'));
</script>
{% endblock %}
